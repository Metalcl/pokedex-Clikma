@if (errorMessage) {
<div class="text-red-500 p-4">{{ errorMessage }}</div>
} @else if (!errorMessage && totalRecords === 0 && !isSearching) {
<div class="p-4">Cargando Pokémon...</div>
}

<div class="card p-4">
  @if (pokemonList$ | async; as data) { @if (data.results || totalRecords > 0) {
  <p-table
    [value]="data.results"
    [paginator]="!isSearching"
    [rows]="rows"
    [first]="first"
    [totalRecords]="totalRecords"
    [rowsPerPageOptions]="[10, 20, 50]"
    [showCurrentPageReport]="true"
    [tableStyle]="{ 'min-width': '50rem' }"
    currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords} Pokémon"
    [lazy]="true"
    (onPage)="onPageChange($event)"
    [scrollHeight]="'flex'"
    [scrollable]="true"
    [tableStyleClass]="'p-datatable-striped'"
  >
    <ng-template #caption>
      <div class="flex justify-between items-center p-2">
        <app-searcher (search)="onSearch($event)"></app-searcher>

        <app-sorter
          [currentDirection]="currentSortDirection"
          (sortChange)="onSortChange($event)"
        ></app-sorter>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th style="width: 25%" class="text-left">Número</th>
        <th style="width: 25%" class="text-center">Nombre</th>
        <th style="width: 25%" class="text-center">Imagen</th>
        <th style="width: 25%" class="text-left">Acción</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-pokemon>
      <tr>
        <td class="align-middle text-center">#{{ getPokemonId(pokemon.url) }}</td>

        <td class="align-middle text-center">
          {{ pokemon.name | titlecase }}
        </td>

        <td class="align-middle text-center">
          <img
            alt="{{ pokemon.name | titlecase }}"
            [src]="pokemon.imageUrlDreamWorld || pokemon.imageUrlDefault"
            style="width: 100px; height: 100px; margin: 0 auto"
          />
        </td>

        <td class="align-middle text-left">
          <p-button
            label="Ver Más"
            (onClick)="onViewDetails(pokemon)"
            icon="pi pi-eye"

          />
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-4">
          No se encontraron Pokémon que coincidan con la búsqueda.
        </td>
      </tr>
    </ng-template>
  </p-table>
  } }
</div>

<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [style]="{ width: '30rem' }"
  header="Detalles de {{ selectedPokemon?.name | titlecase }}"
>
  <div class="p-4">
    @if (selectedPokemon) {
    <p>Datos del Pokémon seleccionado:</p>
    <pre>{{ selectedPokemon | json }}</pre>
    } @else {
    <p>Contenido del diálogo vacío.</p>
    }
  </div>

  <ng-template #footer>
    <p-button label="Cerrar" [text]="true" (click)="visible = false" />
  </ng-template>
</p-dialog>
