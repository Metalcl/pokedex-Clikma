<div>
    <div class="toolbar-container">
        <app-searcher (search)="onSearch($event)"></app-searcher>

        <app-sorter
            [currentDirection]="currentSortDirection"
            (sortChange)="onSortChange($event)"
        ></app-sorter>
    </div>

    @if (pokemonList$ | async; as data) {
        @if (data && data.results && data.results.length > 0) {

            <div class="pokedex-grid">
                @for (pokemon of data.results; track pokemon.name) {
                <p-card
                    [header]="pokemon.name | titlecase"
                    [subheader]="'#' + getPokemonId(pokemon.url)"
                    [style]="{ width: '18rem', margin: '1rem', textAlign: 'center', cursor: 'pointer' }"
                    (click)="onViewDetails(pokemon)"
                    class="pokemon-grid-card"
                >
                    <div>
                        <img
                            alt="{{ pokemon.name | titlecase }}"
                            [src]="pokemon.imageUrlDreamWorld || pokemon.imageUrlDefault"
                            style="width: 150px; height: 150px; margin: 0 auto; display: block"
                        />
                    </div>
                </p-card>
                }
            </div>

            @if (!isSearching) {
            <p-paginator
                [rows]="limit"
                [totalRecords]="totalRecords"
                [first]="offset"
                [rowsPerPageOptions]="[10, 20, 50]"
                (onPageChange)="onPageChange($event)"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords} Pokémon"
            >
            </p-paginator>
            }

        } @else {
            @if (errorMessage) {
            <p>{{ errorMessage }}</p>
            } @else {
            <p>No se encontraron Pokémon.</p>
            }
        }
    } @else {
        <div class="pokedex-grid">
            @for (item of [].constructor(limit); track $index) {
            <p-card
                [style]="{ width: '18rem', margin: '1rem', textAlign: 'center' }"
                header="&nbsp;"
                subheader="&nbsp;"
            >
                <ng-template #header>
                    <p-skeleton width="70%" height="1.5rem" style="margin: 1rem auto 0.5rem"></p-skeleton>
                    <p-skeleton width="30%" height="1rem" style="margin: 0.5rem auto 1rem"></p-skeleton>
                </ng-template>
            </p-card>
            }
        </div>
    }

    <p-dialog
        [(visible)]="visible"
        [modal]="true"
        [style]="{ width: '40rem' }"
        header="Información detallada"
    >
        <div class="dialog-content-wrapper">
            @if (fullPokemonDetails$ | async; as details) {
                @if (details === 'error') {
                <p class="error-text">Error al cargar los detalles completos del Pokémon.</p>
                } @else {
                <p-card
                    [header]="details.name | titlecase"
                    [subheader]="'N° : ' + details.id"
                    class="pokemon-detail-card"
                >
                    <div class="image-type-container">
                        <hr class="separator" />

                        <div class="image-types-group">
                            @if (pokemonSprites.length > 0) {
                            <p-carousel
                                [value]="pokemonSprites"
                                [numVisible]="1"
                                [numScroll]="1"
                                [responsiveOptions]="responsiveOptions"
                                styleClass="pokemon-carousel"
                            >
                                <ng-template let-spriteUrl #item>
                                    <div class="carousel-item-wrapper">
                                        <img
                                            [src]="spriteUrl"
                                            [alt]="details.name | titlecase"
                                            class="pokemon-sprite"
                                            style="height: 20rem; width: auto"
                                        />
                                    </div>
                                </ng-template>
                            </p-carousel>
                            } @else {
                            <div class="no-image-placeholder">Imagen no disponible</div>
                            }

                            <h4 class="visually-hidden">Tipo</h4>

                            <div class="type-icons-wrapper">
                                @for (typeInfo of details.types; track typeInfo.slot) {
                                <img
                                    [src]="'/types/' + typeInfo.type.name.toLowerCase() + '.png'"
                                    [title]="getTypeNameInSpanish(typeInfo.type.name)"
                                    [alt]="'Tipo ' + getTypeNameInSpanish(typeInfo.type.name)"
                                    style="height: 3.5rem; width: 3.5rem; object-fit: contain"
                                    class="type-icon"
                                />
                                }
                            </div>
                        </div>

                        <hr class="separator" />

                        <div class="stats-group">
                            <h4 class="stats-title">Información básica</h4>

                            <div class="basic-info-horizontal">
                                <p>
                                    Altura: <b>{{ details.height / 10 }} m</b>
                                </p>
                                <p>
                                    Peso: <b>{{ details.weight / 10 }} kg</b>
                                </p>
                            </div>
                        </div>
                    </div>

                    <hr class="separator" />

                    <div class="stats-group chart-container">
                        <h4 class="stats-title">Estadísticas Base</h4>

                        @if (statsData) {
                        <p-chart
                            type="radar"
                            [data]="statsData"
                            [options]="statsOptions"
                            class="pokemon-radar-chart"
                        />
                        }
                    </div>
                </p-card>
                }
            } @else {
            <p>Cargando detalles del Pokémon...</p>
            }
        </div>
    </p-dialog>
</div>
